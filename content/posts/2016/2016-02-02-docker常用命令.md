---
title: dockerå¸¸ç”¨å‘½ä»¤
author: admin
type: post
date: 2016-02-02T09:38:20+00:00
url: /archives/16555
categories:
 - æœåŠ¡å™¨
tags:
 - docker

---
å®˜æ–¹å‘½ä»¤ï¼š [https://docs.docker.com/reference/](https://docs.docker.com/reference/)

## 1. æŸ¥çœ‹dockerä¿¡æ¯ï¼ˆversionã€infoï¼‰

```
# æŸ¥çœ‹dockerç‰ˆæœ¬
$docker version

# æ˜¾ç¤ºdockerç³»ç»Ÿçš„ä¿¡æ¯
$docker info
```

## 2. å¯¹imageçš„æ“ä½œï¼ˆsearchã€pullã€imagesã€rmiã€historyï¼‰

```
# æ£€ç´¢image(sudo docker pull ubuntu:12.04,è¯¥å‘½ä»¤å®é™…ä¸Šç›¸å½“äº $ sudo docker pull registry.hub.docker.com/ubuntu:12.04 å‘½ä»¤ï¼Œå³ä»æ³¨å†ŒæœåŠ¡å™¨ registry.hub.docker.com ä¸­çš„ ubuntu ä»“åº“æ¥ä¸‹è½½æ ‡è®°ä¸º 12.04 çš„é•œåƒã€‚)
$docker search image_name[:tag]

# ä¸‹è½½image
$docker pull image_name

# åˆ—å‡ºé•œåƒåˆ—è¡¨; -a, --all=false Show all images; --no-trunc=false Don't truncate output; -q, --quiet=false Only show numeric IDs
$docker images

# é•œåƒé‡å‘½å
docker tag ImageID(é•œåƒid) REPOSITORY:TAGï¼ˆä»“åº“ï¼šæ ‡ç­¾ï¼‰

# åˆ é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªé•œåƒ; -f, --force=false Force; --no-prune=false Do not delete untagged parents ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯ rmi å‘½ä»¤ï¼Œä¸æ˜¯ rmï¼‰
$docker rmi image_name

# æ˜¾ç¤ºä¸€ä¸ªé•œåƒçš„å†å²; --no-trunc=false Don't truncate output; -q, --quiet=false Only show numeric IDs
$docker history image_name
```

## 3.Â å¯åŠ¨å®¹å™¨ï¼ˆrunï¼‰

dockerå®¹å™¨å¯ä»¥ç†è§£ä¸ºåœ¨æ²™ç›’ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚è¿™ä¸ªæ²™ç›’åŒ…å«äº†è¯¥è¿›ç¨‹è¿è¡Œæ‰€å¿…é¡»çš„èµ„æºï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€ç³»ç»Ÿç±»åº“ã€shell ç¯å¢ƒç­‰ç­‰ã€‚ä½†è¿™ä¸ªæ²™ç›’é»˜è®¤æ˜¯ä¸ä¼šè¿è¡Œä»»ä½•ç¨‹åºçš„ã€‚ä½ éœ€è¦åœ¨æ²™ç›’ä¸­è¿è¡Œä¸€ä¸ªè¿›ç¨‹æ¥å¯åŠ¨æŸä¸€ä¸ªå®¹å™¨ã€‚è¿™ä¸ªè¿›ç¨‹æ˜¯è¯¥å®¹å™¨çš„å”¯ä¸€è¿›ç¨‹ï¼Œæ‰€ä»¥å½“è¯¥è¿›ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œå®¹å™¨ä¹Ÿä¼šå®Œå…¨çš„åœæ­¢ã€‚


```
# åœ¨å®¹å™¨ä¸­è¿è¡Œ"echo"å‘½ä»¤ï¼Œè¾“å‡º"hello word"
$docker run image_name echo "hello word"

# äº¤äº’å¼è¿›å…¥å®¹å™¨ä¸­
$docker run -i -t image_name /bin/bash

# åœ¨å®¹å™¨ä¸­å®‰è£…æ–°çš„ç¨‹åº
$docker run image_name apt-get install -y app_name
```

å…¶ä¸­ï¼Œ**`-t`** é€‰é¡¹è®©Dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼ˆpseudo-ttyï¼‰å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Šï¼Œ **`-i`** åˆ™è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€ã€‚

Noteï¼š Â åœ¨æ‰§è¡Œapt-get å‘½ä»¤çš„æ—¶å€™ï¼Œè¦å¸¦ä¸Š-yå‚æ•°ã€‚å¦‚æœä¸æŒ‡å®š-yå‚æ•°çš„è¯ï¼Œapt-getå‘½ä»¤ä¼šè¿›å…¥äº¤äº’æ¨¡å¼ï¼Œéœ€è¦ç”¨æˆ·è¾“å…¥å‘½ä»¤æ¥è¿›è¡Œç¡®è®¤ï¼Œä½†åœ¨dockerç¯å¢ƒä¸­æ˜¯æ— æ³•å“åº”è¿™ç§äº¤äº’çš„ã€‚apt-get å‘½ä»¤æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå®¹å™¨å°±ä¼šåœæ­¢ï¼Œä½†å¯¹å®¹å™¨çš„æ”¹åŠ¨ä¸ä¼šä¸¢å¤±ã€‚

## 4. æŸ¥çœ‹å®¹å™¨ï¼ˆpsï¼‰

```
# åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„container
$docker ps
# åˆ—å‡ºæ‰€æœ‰çš„container
$docker ps -a
# åˆ—å‡ºæœ€è¿‘ä¸€æ¬¡å¯åŠ¨çš„container
$docker ps -l
```

## 5. ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹ï¼ˆcommitï¼‰

å½“ä½ å¯¹æŸä¸€ä¸ªå®¹å™¨åšäº†ä¿®æ”¹ä¹‹åï¼ˆé€šè¿‡åœ¨å®¹å™¨ä¸­è¿è¡ŒæŸä¸€ä¸ªå‘½ä»¤ï¼‰ï¼Œå¯ä»¥æŠŠå¯¹å®¹å™¨çš„ä¿®æ”¹ä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·ä¸‹æ¬¡å¯ä»¥ä»ä¿å­˜åçš„æœ€æ–°çŠ¶æ€è¿è¡Œè¯¥å®¹å™¨ã€‚

```
# ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹; -a, --author="" Author; -m, --message="" Commit message
$docker commit ID new_image_name
```

Noteï¼šÂ Â imageç›¸å½“äºç±»ï¼Œcontainerç›¸å½“äºå®ä¾‹ï¼Œä¸è¿‡å¯ä»¥åŠ¨æ€ç»™å®ä¾‹å®‰è£…æ–°è½¯ä»¶ï¼Œç„¶åæŠŠè¿™ä¸ªcontainerç”¨commitå‘½ä»¤å›ºåŒ–æˆä¸€ä¸ªimageã€‚

## 6. å¯¹å®¹å™¨çš„æ“ä½œï¼ˆrmã€stopã€startã€killã€logsã€diffã€topã€cpã€restartã€attachï¼‰

```
# åˆ é™¤æ‰€æœ‰å®¹å™¨
$docker rm `docker ps -a -q`

# åˆ é™¤å•ä¸ªå®¹å™¨; -f, --force=false; -l, --link=false Remove the specified link and not the underlying container; -v, --volumes=false Remove the volumes associated to the container
$docker rm Name/ID

# åœæ­¢ã€å¯åŠ¨ã€æ€æ­»ä¸€ä¸ªå®¹å™¨
$docker stop Name/ID
$docker start Name/ID
$docker kill Name/ID

# ä»ä¸€ä¸ªå®¹å™¨ä¸­å–æ—¥å¿—; -f, --follow=false Follow log output; -t, --timestamps=false Show timestamps
$docker logs Name/ID

# åˆ—å‡ºä¸€ä¸ªå®¹å™¨é‡Œé¢è¢«æ”¹å˜çš„æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œliståˆ—è¡¨ä¼šæ˜¾ç¤ºå‡ºä¸‰ç§äº‹ä»¶ï¼ŒA å¢åŠ çš„ï¼ŒD åˆ é™¤çš„ï¼ŒC è¢«æ”¹å˜çš„
$docker diff Name/ID

# æ˜¾ç¤ºä¸€ä¸ªè¿è¡Œçš„å®¹å™¨é‡Œé¢çš„è¿›ç¨‹ä¿¡æ¯
$docker top Name/ID

# ä»å®¹å™¨é‡Œé¢æ‹·è´æ–‡ä»¶/ç›®å½•åˆ°æœ¬åœ°ä¸€ä¸ªè·¯å¾„
$docker cp Name:/container_path to_path
$docker cp ID:/container_path to_path

# é‡å¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨; -t, --time=10 Number of seconds to try to stop for before killing the container, Default=10
$docker restart Name/ID

# é™„åŠ åˆ°ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨ä¸Šé¢; --no-stdin=false Do not attach stdin; --sig-proxy=true Proxify all received signal to the process
$docker attach ID
Noteï¼šÂ attachå‘½ä»¤å…è®¸ä½ æŸ¥çœ‹æˆ–è€…å½±å“ä¸€ä¸ªè¿è¡Œçš„å®¹å™¨ã€‚ä½ å¯ä»¥åœ¨åŒä¸€æ—¶é—´attachåŒä¸€ä¸ªå®¹å™¨ã€‚ä½ ä¹Ÿå¯ä»¥ä»ä¸€ä¸ªå®¹å™¨ä¸­è„±ç¦»å‡ºæ¥ï¼Œæˆ–è€…æŒ‰CTRL-Cã€‚æ³¨æ„è¿™ç§æ–¹å¼è¿›å…¥çª—å£å†é€€å‡ºçª—å£ä¼šè‡ªåŠ¨åœæ­¢ã€‚
æˆ–è€…
sudo docker exec -it CONTAINER-NAME|CONTAINER-ID /bin/bash // æ¨è,å‚è€ƒï¼šhttps://www.cnblogs.com/xhyan/p/6593075.html

# æŸ¥çœ‹çª—å£ç¯å¢ƒå˜é‡
$docker inspect CONTAINER-NAME|CONTAINER-ID
æˆ–è€…
$docker exec -it CONTAINER-NAME|CONTAINER-ID env // æ¨è

# åœ¨å®¹å™¨è¿è¡Œä¸€ä¸ªå‘½ä»¤
$docker exec -it CONTAINER-NAME|CONTAINER-ID echo "test"
ä¼šæ‰“å°è¾“å‡º test å­—æ ·

```

å‘½ä»¤ç¤ºä¾‹ï¼š [https://docs.gitlab.com/omnibus/docker/](https://docs.gitlab.com/omnibus/docker/)

## 7. ä¿å­˜å’ŒåŠ è½½é•œåƒï¼ˆsaveã€loadï¼‰

å½“éœ€è¦æŠŠä¸€å°æœºå™¨ä¸Šçš„é•œåƒè¿ç§»åˆ°å¦ä¸€å°æœºå™¨çš„æ—¶å€™ï¼Œéœ€è¦ä¿å­˜é•œåƒä¸åŠ è½½é•œåƒã€‚

```
# ä¿å­˜é•œåƒåˆ°ä¸€ä¸ªtaråŒ…; -o, --output="" Write to an file
$docker save image_name -o file_path
# åŠ è½½ä¸€ä¸ªtaråŒ…æ ¼å¼çš„é•œåƒ; -i, --input="" Read from a tar archive file
$docker load -i file_path

# æœºå™¨a
$docker save image_name > /home/save.tar
# ä½¿ç”¨scpå°†save.taræ‹·åˆ°æœºå™¨bä¸Šï¼Œç„¶åï¼š
$docker load < /home/save.tar
```

## 8ã€ ç™»å½•registry serverï¼ˆloginï¼‰

```
# ç™»é™†registry server; -e, --email="" Email; -p, --password="" Password; -u, --username="" Username
$docker login
```

å¦‚æœæç¤ºé”™è¯¯

```
Error saving credentials: error storing credentials - err: exit status 1, out: `The user name or passphrase you entered is not correct.`
```

â€è§£å†³åŠæ³•ä¸º

```
rm /usr/local/bin/docker-credential-osxkeychain
```

## 9. å‘å¸ƒimageï¼ˆpushï¼‰

```
# å‘å¸ƒdockeré•œåƒ
$docker push new_image_name
```

## 10.Â Â æ ¹æ®Dockerfile æ„å»ºå‡ºä¸€ä¸ªå®¹å™¨

```
#build
      --no-cache=false Do not use cache when building the image
      -q, --quiet=false Suppress the verbose output generated by the containers
      --rm=true Remove intermediate containers after a successful build
      -t, --tag="" Repository name (and optionally a tag) to be applied to the resulting image in case of success
$docker build -t image_name Dockerfile_path
```

## 11. Docker ä¿®æ”¹å·²æœ‰é•œåƒï¼ˆcommit ï¼‰

```
docker commit -m 'è¯´æ˜ä¿¡æ¯' -a 'ä½œè€…ä¿¡æ¯' å®¹å™¨ID é•œåƒIDåç§°[:TAG_ID]
```

ä¿®æ”¹æˆåŠŸåï¼Œè¿”å›é•œåƒIDä¿¡æ¯ï¼Œå¦‚ sha256:e53af4b57f5db62e8129031353a41147ab25c5c33e89b460dec97472eefdacd1

ä»¥ä¸Šæ˜¯é€šè¿‡ä¿®æ”¹å®¹å™¨æ¥å®ç°å¯¹é•œåƒçš„åˆ›å»ºï¼Œå¦‚æœåªæ˜¯ä»…ä»…æƒ³ä¿ç•™å®¹å™¨çš„å†…å®¹ï¼Œçœç•¥æ‰å‘½ä»¤åé¢çš„é•œåƒä¿¡æ¯å³å¯ã€‚
[https://blog.csdn.net/jiankunking/article/details/62056392](https://blog.csdn.net/jiankunking/article/details/62056392)

æ¨èé˜…è¯»ï¼š [å¦‚ä½•ä½¿ç”¨Dockerfileæ„å»ºé•œåƒ](http://blog.csdn.net/we_shell/article/details/38445979)



å‚è€ƒï¼š [http://blog.csdn.net/zhang__jiayu/article/details/42611469](http://blog.csdn.net/zhang__jiayu/article/details/42611469)
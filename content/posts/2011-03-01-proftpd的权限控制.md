---
title: proftpd的权限控制
author: admin
type: post
date: 2011-03-01T14:45:19+00:00
url: /archives/7915
IM_contentdowned:
 - 1
categories:
 - 服务器
tags:
 - proftpd

---
proftpd以完美的权限控制著称…所以这个教程的目的是让大家理解proftpd的权限设置的过程
拿我的music ftp来举例子了.

代码:

* * *

`<directory /usr/local/music><br />
#在/usr/local/music这个目录中的权限设置<br />
<limit RMD DELE SITE_CHMOD><br />
denygroup pubfxp<br />
</limit><br />
#上面的内容限制pubfxp这个<span style="color: red;">组</span>删除目录(RMD),删除文件(DEL),和执行chmod命令(SITE_CHMOD)<br />
<limit RMD RNTO DELE STOR MKD SITE_CHMOD RETR><br />
denyuser onlyup<br />
</limit><br />
#上面的内容限制onlyup这个<span style="color: blue;">用户</span>,删除目录(RMD),删除文件(DEL),和执行chmod命令(SITE_CHMOD),上传(STOR),建目录(MKD),下载(RETR),重命名(RNTO)<br />
<limit RMD RNTO DELE SITE_CHMOD MKD STOR><br />
denygroup read<br />
</limit><br />
#上面的内容限制read这个<span style="color: red;">组</span>,删除目录(RMD),重命名(RNTO),建目录(MKD),删除文件(DEL),和执行chmod命令(SITE_CHMOD)<br />
</directory><br />
<br />
<directory /usr/local/music/80g_2/incoming><br />
#在/usr/local/music/80g_2/incoming中的权限设置<br />
<limit MKD STOR><br />
allowuser onlyup<br />
</limit><br />
#上面的内容允许onlyup这个<span style="color: blue;">用户</span>,建立目录(MKD),上传(STOR)</p>
<p></directory>`

#对”~/xishare/” ,除ftpuser1能上传外，其他用户只能下载。符合“～”表示用户的home目录。

DenyAll

AllowOverwrite on

AllowRetrieveRestart on

AllowStoreRestart on

DenyUser !ftpuser1

AllowStoreRestart on

#对”~/pub/” 可以（覆盖）上传、下载、创建目录，不能删除

DenyAll

AllowOverwrite on

AllowRetrieveRestart on

AllowStoreRestart on

#不允许Root用户访问ftp

RootLogin off

#设置如果shell为空时允许用户登录：

RequireValidShell off

#限制每个FTP用户在自己的目录下，不可查看上一级目录

DefaultRoot ~

AllowRetrieveRestart on #下载时，允许断点续传

AllowStoreRestart on #上传时，允许断点续传

ServerIdent off #屏蔽服务器版本信息

#最大尝试连接次数

MaxLoginAttempts 8

#日志文件位置

SystemLog /var/log/proftpd.log

* * *

ok来看看我为什么这样设置…
第一步..我先设置整个music目录的权限.禁止了onlyup这个用户在music目录的所有权限…
pubfxp这个组只有写,重命名,而没有删除的权限,read这个组只有读的权限..

第二步..我在80g_2/incoming中允许onlyup有写的权限…这个会覆盖掉music目录中对应的权限设置..但是其他没有说明的权限还是被禁止的..

这样就用很少的控制码达到权限控制的目的了..:)

proftpd的组设置功能非常好用…我通过mysql来做验证的…
只要在mysql的语句部分加一句
SQLGroupInfo groups groupname gid members

具体的组的内容是这样的范例..:)

PHP 代码:


* * *

`</p>
<div dir="ltr"><code>groupname  gid  members<br />
read             99   ndvip,zg,HYD,ronor<br />
`

* * *

mysql的支持文档: [http://www.castaglia.org/proftpd/doc…HOWTO-SQL.html](http://www.castaglia.org/proftpd/doc/contrib/ProFTPD-mini-HOWTO-SQL.html)

这里注意一下组的gid最好用一个系统存在的组..否则权限比较莫名的出错..偶在这里卡了一天时间…


另..调试proftpd的利器…在conf文件中加入

SQLLogFile /var/log/proftpd_sql_log


然后就是分析log了..hoho…


转自： [http://blog.csdn.net/eagelangel/archive/2008/10/13/3071061.aspx](http://blog.csdn.net/eagelangel/archive/2008/10/13/3071061.aspx)
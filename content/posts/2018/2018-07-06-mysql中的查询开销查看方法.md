---
title: MySQL中的查询开销查看方法
author: admin
type: post
date: 2018-07-06T01:37:40+00:00
url: /archives/17932
categories:
 - MySQL
tags:
 - mysql优化

---

MySQL使用基于 **成本的优化器**，它尝试预测一个查询使用某种执行计划时的成本，并选择其中成本最小的一个。在MySQL可以通过查询当前会话的 `last_query_cost` 的值来得到其计算当前查询的成本。


```sql
mysql> select * from t_message limit 10;
...省略结果集

mysql> show status like 'last_query_cost'
+-----------------+-------------+
| Variable_name   | Value      |
+-----------------+-------------+
| Last_query_cost| 6391.799000 |
+-----------------+-------------+

```

示例中的结果表示优化器认为大概需要做6391个数据页的随机查找才能完成上面的查询。这个结果是根据一些列的统计信息计算得来的，这些统计信息包括： **每张表或者索引的页面个数**、 **索引的基数**、 **索引** 和 **数据行的长度**、 **索引的分布** 情况等等。


有非常多的原因会导致MySQL选择错误的执行计划，比如统计信息不准确、不会考虑不受其控制的操作成本（用户自定义函数、存储过程）、**MySQL认为的最优跟我们想的不一样（我们希望执行时间尽可能短，但MySQL值选择它认为成本小的，但成本小并不意味着执行时间短）等等。**

这里last_query_cost的值是 **io_cost** 和 **cpu_cost** 的开销总和，它通常也是我们评价一个查询的执行效率的一个常用指标。


(1)它是作为比较各个查询之间的开销的一个依据。


(2)它只能检测比较简单的查询开销，对于包含子查询和union的查询是测试不出来的。


(3)当我们执行查询的时候，MySQL会自动生成一个执行计划，也就是query  plan，而且通常有很多种不同的实现方式，它会选择最低的那一个，而这个cost值就是开销最低的那一个。


(4)它对于比较我们的开销是非常有用的，特别是我们有好几种查询方式可选的时候。
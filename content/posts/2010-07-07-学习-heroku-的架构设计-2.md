---
title: 学习 HeroKu 的架构设计
author: admin
type: post
date: 2010-07-07T15:29:10+00:00
url: /archives/4496
IM_data:
 - 'a:8:{s:52:"http://www.dbanotes.net/Images/HeroKu%20Overview.jpg";s:60:"http://blog.haohtml.com/wp-content/uploads/2011/03/54c31.jpg";s:59:"http://www.dbanotes.net/Images/HeroKu%20Reverse%20Proxy.jpg";s:60:"http://blog.haohtml.com/wp-content/uploads/2011/03/7990f.jpg";s:56:"http://www.dbanotes.net/Images/HeroKu%20HTTP%20cache.jpg";s:60:"http://blog.haohtml.com/wp-content/uploads/2011/03/d167a.jpg";s:58:"http://www.dbanotes.net/Images/HeroKu%20Routing%20Mesh.jpg";s:60:"http://blog.haohtml.com/wp-content/uploads/2011/03/f0e48.jpg";s:55:"http://www.dbanotes.net/Images/HeroKu%20Dyno%20Grid.jpg";s:60:"http://blog.haohtml.com/wp-content/uploads/2011/03/1f0a7.jpg";s:62:"http://www.dbanotes.net/Images/HeroKu%20Dyno%20Grid%20Arch.jpg";s:60:"http://blog.haohtml.com/wp-content/uploads/2011/03/d68ad.jpg";s:52:"http://www.dbanotes.net/Images/HeroKu%20Database.jpg";s:60:"http://blog.haohtml.com/wp-content/uploads/2011/03/a00f5.jpg";s:53:"http://www.dbanotes.net/Images/HeroKu%20Memcached.jpg";s:60:"http://blog.haohtml.com/wp-content/uploads/2011/03/58c24.jpg";}'
IM_contentdowned:
 - 1
categories:
 - 系统架构
tags:
 - 网站架构
 - 架构

---
这几天给我印象比较深的是 [HeroKu][1] ，提供 Ruby 快速部署环境并提供托管能力，他们的架构图做得十分漂亮，一幅图胜过千言万语，要是对 Web 架构感兴趣，都别问架构师了，看看 HeroKu 的架构估计就明白个差不多了 🙂

**概览图**

好的架构图是画出来的，好的架构未必是设计出来的，最后架构好不好，还要看持续的改进能力。

![HeroKu Overview.jpg](http://www.dbanotes.net/Images/HeroKu%20Overview.jpg)

**HTTP 反向代理**

使用 [Nginx][2] , 这一层只进行 HTTP-level 的处理。Nginx 现在是不二选择。

![HeroKu Reverse Proxy.jpg](http://www.dbanotes.net/Images/HeroKu%20Reverse%20Proxy.jpg)

**HTTP Cache**

对于静态内容，使用 [Varnish][3] 进行缓存。如果你在 Squid 和 Varnish 之间作选择，这里已经投了一票。

![HeroKu HTTP  cache.jpg](http://www.dbanotes.net/Images/HeroKu%20HTTP%20cache.jpg)

**路由网(Routing Mesh)**

用 [Erlang][4] 实现的架构组件，路由寻址，用以提升可用性和扩展性。

![HeroKu Routing Mesh.jpg](http://www.dbanotes.net/Images/HeroKu%20Routing%20Mesh.jpg)

**动态网格(Dyno Grid)**

用户部署的代码运行在这里，可以简单看成是应用服务器集群环境，只是粒度更小一点而已。

![HeroKu Dyno Grid.jpg](http://www.dbanotes.net/Images/HeroKu%20Dyno%20Grid.jpg)

对于 Dyno Grid 的进一步信息：

![HeroKu Dyno Grid Arch.jpg](http://www.dbanotes.net/Images/HeroKu%20Dyno%20Grid%20Arch.jpg)

服务器操作系统是 Debian ；Ruby VM 是 MRI ，开源，C 写的；App Server 用的 [Thin][5]，他们说 Thin 比 [Mongrel][6] 更精炼；Rack，应用服务器接口；Rack 中间件，可选组件；框架，任何 Rack 兼容的都成；最后是客户托管的代码。

**数据库**

[PostgreSQL][7]，也可以采用远程数据库。

![HeroKu Database.jpg](http://www.dbanotes.net/Images/HeroKu%20Database.jpg)

**Memory Cache**

Memcached ，居家旅行架构必备。

![HeroKu Memcached.jpg](http://www.dbanotes.net/Images/HeroKu%20Memcached.jpg)

这几张图看下来，多少算是对 Ruby 环境有了一些感性认识。可以进一步查看 HeroKu 提供的[文档][8]，包含了一些代码实现上的准则。

部署是基于 [Git][9] 的。不知道大家有没有注意到 Git 在最近一年来的爆发? 超过 SVN 或许不是不可能的。

国内热炒”云计算”的，跟人家学学吧，与其整天帮着客户开发定制软件，还不如给客户提供一些弹性应用托管环境，起码看起来靠谱一些。

HeroKu ，不读 Hero-Ku, 读作 Her-oh-koo, 挺有趣

来源： [http://www.dbanotes.net/arch/heroku_architecture.html](http://www.dbanotes.net/arch/heroku_architecture.html)

 [1]: http://heroku.com/
 [2]: http://nginx.net/
 [3]: http://varnish.projects.linpro.no/
 [4]: http://erlang.org/
 [5]: http://code.macournoyer.com/thin/
 [6]: http://en.wikipedia.org/wiki/Mongrel_%28web_server%29
 [7]: http://www.postgresql.org/
 [8]: http://heroku.com/docs
 [9]: http://git-scm.com/
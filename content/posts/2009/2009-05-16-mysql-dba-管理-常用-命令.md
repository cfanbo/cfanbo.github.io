---
title: MySQL DBA ç®¡ç† å¸¸ç”¨ å‘½ä»¤
author: admin
type: post
date: 2009-05-16T04:12:13+00:00
excerpt: |
 è™½ç„¶è‡ªå·±ä¸æ˜¯DBAï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå¤šå¤šå°‘å°‘ï¼Œåº”è¯¥äº†è§£ä¸€äº›æ•°æ®åº“æ–¹é¢çš„ä¸œè¥¿ï¼Œå¹¶ä¸èƒ½åªå…³å¿ƒç¨‹åºï¼Œä¸è€ƒè™‘æ•°æ®åº“ï¼Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œå°±å…ˆè½¬è¿‡æ¥ï¼Œä¹Ÿè®¸ä»¥åè‡ªå·±å“ªå¤©ä¼šç”¨åˆ°ã€‚

 æŸ¥çœ‹mysqlçš„æŸä¸ªé€‰é¡¹
 show variables like â€˜%VAR_NAME%â€™;
 select @@VAR_NAME;
url: /archives/1389
IM_contentdowned:
 - 1
categories:
 - MySQL
tags:
 - dba
 - mysql

---
è™½ç„¶è‡ªå·±ä¸æ˜¯DBAï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå¤šå¤šå°‘å°‘ï¼Œåº”è¯¥äº†è§£ä¸€äº›æ•°æ®åº“æ–¹é¢çš„ä¸œè¥¿ï¼Œå¹¶ä¸èƒ½åªå…³å¿ƒç¨‹åºï¼Œä¸è€ƒè™‘æ•°æ®åº“ï¼Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œå°±å…ˆè½¬è¿‡æ¥ï¼Œä¹Ÿè®¸ä»¥åè‡ªå·±å“ªå¤©ä¼šç”¨åˆ°ã€‚

æŸ¥çœ‹mysqlçš„æŸä¸ªé€‰é¡¹
show variables like â€˜%VAR_NAME%â€™;

 select @@VAR_NAME;

Â Â Â  åœ¨Linuxä¸‹ç®¡ç†MySQLæ•°æ®åº“çš„æ—¶å€™æ€»æœ‰ä¸€äº›å¾ˆç´§æ€¥çš„æƒ…å†µï¼Œå‘ç°æ•°æ®åº“çªç„¶å˜å¾—å‹åŠ›å¾ˆå¤§äº†ï¼Œé‚£ä¹ˆä½œä¸ºä¸€ä¸ªDBAï¼Œä¹Ÿè®¸éœ€è¦ä¸€äº›å¸¸ç”¨çš„æ‰‹æ®µæˆ–è€…è¯´å‘½ä»¤å»åˆ†æé—®é¢˜å‡ºç°åœ¨å“ªé‡Œï¼Œç„¶åè§£å†³ï¼š

æ•°æ®åº“çªç„¶äº§ç”Ÿå‹åŠ›æ—¶æŸ¥çœ‹æ­£åœ¨æŸ¥è¯¢çš„SQL:(å¦‚æœè¿™é‡Œå†…å®¹å¤ªå¤šè¡¨ç¤ºå¹¶å‘æ‰§è¡Œçš„SQLè¿‡å¤šï¼Œæˆ–è®¸æ•°æ®åº“å µå¡äº†ï¼Œä¼šè¶Šæ¥è¶Šæ…¢ï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿™é‡Œåº”è¯¥å¾ˆå°‘æœ‰ä¸œè¥¿çš„ï¼Œä¹Ÿå°±æ˜¯è¿æ¥éƒ½åœ¨SleepçŠ¶æ€ï¼‰
/usr/local/mysql/bin/mysql -uroot -ppassword databaseNameÂ  -e â€œshow full processlistâ€ | grep -v Sleep

æ­£åœ¨è¿è¡Œçš„SQLå¤ªå¤šäº†ï¼Œçœ‹ä¸è¿‡æ¥ï¼Œé‚£éœ€è¦æ’åºäº†ï¼Œçœ‹æŒç»­æ‰§è¡Œæ—¶é—´æœ€é•¿çš„é‚£äº›SQLï¼š
/usr/local/mysql/bin/mysql -uroot -ppassword databaseNameÂ  -e â€œshow full processlistâ€ | grep -v Sleep | sort -k6rn >sort.tmp

å¦‚æœå‘ç°IOWaitå¾ˆé«˜ï¼Œè¯·æŸ¥çœ‹ä¸´æ—¶è¡¨çš„ç”Ÿæˆæƒ…å†µï¼Œç‰¹åˆ«æ˜¯disk tmp table:
/usr/local/mysql/bin/mysql -uroot -ppassword databaseNameÂ  -e â€œshow global status like â€˜%tmp%â€™â€

é€šè¿‡è¿™æ ·ä¸€äº›åŠæ³•å¯ä»¥æŸ¥çœ‹æ•°æ®åº“éƒ½åœ¨å¿™ä»€ä¹ˆï¼Œé‚£äº›å¿™çš„SQLåˆå…·ä½“åœ¨å“ªä¸€ä¸ªæ­¥éª¤ä¸Šå¡ä½äº†ï¼Œæ˜¯åœ¨åˆ›å»ºç£ç›˜ä¸´æ—¶æ–‡ä»¶ã€Sending Dataã€statisticsï¼Ÿä¾ç…§ä¸åŒçš„åŸå› æ¥è§£å†³é—®é¢˜

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
å…³äºMysql Replicationæ—¥å¸¸ç®¡ç†ï¼Œé‡åšï¼Œé—®é¢˜åˆ†ææ—¶å¸¸ç”¨çš„åŠæ³•ï¼š

é‡åšSlaveï¼Œæˆ–è€…Masterå˜åŒ–ç­‰ç­‰ï¼Œéœ€è¦å°†Slaveä¸æ–°çš„MasteråŒæ­¥ï¼š
change master to master\_host=IP,master\_user=â€™replication userNameâ€™,master
\_password=â€™replication Passwrodâ€™,master\_log\_file=â€™log-bin.000001â€²,master\_log_pos=0;

å¯¼å‡ºæ•°æ®æˆSQLæ–‡æœ¬ï¼Œæ…ç”¨ï¼Œæ ¹æ®ä½ çš„DBå¤§å°ä¼šé”è¡¨ï¼Œå¯¼è‡´å µå¡å…¶ä»–è®¿é—®ï¼š
nohup /usr/local/mysql/bin/mysqldump â€“database DATABASEName -uUserName -pPassWord â€“lock-all-tables -F >DATA20070519.sql &
-Fåä¼šåˆ·æ–°Master Logè¿™æ ·é…åˆä¸Šé¢çš„Change Masterå¯ä»¥è®©Slaveè¿›è¡ŒåŒæ­¥

åªå¯¼å‡ºæ•°æ®åº“çš„ç»“æ„ï¼ˆæ²¡æœ‰ä»»ä½•å†…å®¹ï¼‰
/usr/local/mysql/bin/mysqldump -d DATABASEName -uUserName -pPassWord >DATA20070519.structure

åªå¯¼å‡ºæ•°æ®åº“çš„æ•°æ®ï¼ˆæ²¡æœ‰åˆ›å»ºè¡¨ç»“æ„çš„è¯­å¥ç­‰ç­‰ï¼‰
/usr/local/mysql/bin/mysqldump -t DATABASEName -uUserName -pPassWord >DATA20070519.data

åŒæ­¥çš„æ—¶å€™å‡ºç°é—®é¢˜ï¼ˆæˆ–è€…å…¶ä»–é—®é¢˜ï¼‰äº†ï¼Œæ ¹æ®åŒæ­¥å‡ºç°é—®é¢˜çš„ä½ç½®ï¼ˆåç§»é‡ï¼‰ï¼ŒæŸ¥çœ‹Binlogçš„å…·ä½“å†…å®¹
/usr/local/mysql/bin/mysqlbinlog binlogFileName â€“start-position=åç§»é‡
å‘µå‘µï¼Œæˆ‘ä»¬ç¢°åˆ°è¿‡Masteræ‰§è¡Œçš„SQLåˆ°äº†Slaveä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼Œå¤Ÿè¯¡å¼‚å§ï¼ä¸è¿‡å°±æ˜¯è¿™æ ·æŸ¥åˆ°äº†åŸå› ï¼šå¦‚æœé€šè¿‡å­˜å‚¨è¿‡ç¨‹å°†bitçš„å†…å®¹æ”¹ä¸º1å°±ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œåæ¥å°†bitæ”¹ä¸ºtinyint(1)å°±å¥½äº†

æˆæƒç»™æŸä¸€å°Slaveæ‹¥æœ‰å¤åˆ¶çš„æƒé™ï¼š
grant replication slave on \*.\* to ç”¨æˆ·å@IP identified by â€˜å¯†ç â€™;

æŸ¥çœ‹SlaveçŠ¶æ€ï¼š
Show slave status \G
æŸ¥çœ‹MasterçŠ¶æ€ï¼š
Show master status;
é‡ç½®Slaveï¼ˆæ…ç”¨ï¼‰
reset slave;
Slaveå‡ºç°é—®é¢˜äº†ï¼Œå…ˆè·³è¿‡è¿™ä¸€æ¡è¯­å¥ï¼ˆè¯·ç¡®è®¤æ‰€è¦è·³è¿‡çš„å…·ä½“å†…å®¹ä¸ä¼šå½±å“åé¢çš„åŒæ­¥ï¼Œç¡®è®¤æ–¹æ³•æŸ¥çœ‹Binlogæ–‡ä»¶ï¼‰ï¼š
set global sql\_slave\_skip_counter=1; (è®°å¾—å…ˆæš‚åœSlaveï¼šstop slave; ç„¶åé‡å¯Slaveï¼šstart slave;)

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“
çº¯ç²¹Linuxç›¸å…³çš„ï¼š
tcpdump -A â€œdst port 3306â€³ æŸ¥çœ‹3306ç«¯å£çš„é€šä¿¡å…·ä½“å†…å®¹ ğŸ™‚
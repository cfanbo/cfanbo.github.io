---
title: 测试golang中的多核多线程
author: admin
type: post
date: 2013-06-18T06:32:48+00:00
url: /archives/14030
categories:
 - 程序开发
tags:
 - golang

---
“并发 (concurrency)” 和 “并行 ( parallelism)” 是不同的。在单个 CPU 核上，线程通过时间片或者让出控制权来实现任务切换，达到 “同时” 运行多个任务的⺫的，这就是所谓的并发。但实际上任何时刻都只有一个任务被执行，其他任务通过某种算法来排队。

多核 CPU 可以让同个进程内的 “多个线程” 做到真正意义上的同时运，它们之间不需要排队 (依然会发生排队，因为线程数量可能超出 CPU 核数量，还有其他的进程等等。这里说的是一个理想状况)，这才是并行。除了多核，并行计算还可能是多台机器上部署运行。

```
package main

import (
"fmt"
"runtime"
)

func test(c chan bool, n int) {

x := 0
for i := 0; i < 1000000000; i++ {
x += i
}

println(n, x)

if n == 9 {
c <- true
}
}

func main() {
runtime.GOMAXPROCS(1) //设置cpu的核的数量，从而实现高并发
c := make(chan bool)

for i := 0; i < 10; i++ {
　go test(c, i)
}

<-c

fmt.Println("main ok")

}
```

测试结果如下：

使用一核的结果

```
[ `go run sendmail.go` | done: 24.6124077s ]
main ok

0 499999999500000000
1 499999999500000000
2 499999999500000000
3 499999999500000000
4 499999999500000000
5 499999999500000000
6 499999999500000000
7 499999999500000000
8 499999999500000000
9 499999999500000000
```

设置8核的结果

```
[ `go run sendmail.go` | done: 6.1073493s ]
main ok

0 499999999500000000
1 499999999500000000
6 499999999500000000
8 499999999500000000
3 499999999500000000
9 499999999500000000
```

可以看出使用1核的执行时间为24秒，而使用8核的执行时间为6秒.运行时间大大减少了．这里没有使用加锁功能的，所以他们的显示顺序是随机的．所以才会出现有些打印结果丢失的问题

注意，这里的执行时间按核的比例减少的，并发的时候也会有阻塞存在的．


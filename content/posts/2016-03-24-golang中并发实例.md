---
title: golangä¸­å¹¶å‘å®ä¾‹
author: admin
type: post
date: 2016-03-24T10:08:38+00:00
url: /archives/16856
categories:
 - ç¨‹åºå¼€å‘
tags:
 - golang

---

```
package main

import (
	"fmt"
	//"runtime"
	"os"
	"runtime/pprof" // å¼•ç”¨pprof package
	"time"
)

func main() {
	f, _ := os.Create("profile_file")
	pprof.StartCPUProfile(f)     // å¼€å§‹cpu profileï¼Œç»“æœå†™åˆ°æ–‡ä»¶fä¸­
	defer pprof.StopCPUProfile() // ç»“æŸprofile

	startTime := time.Now().Second()
	//runtime.GOMAXPROCS(runtime.NumCPU())

	// æ³¨æ„è¿™é‡Œçš„ç¼“å­˜å¤§å°
	ch := make(chan int, 100)
	quit := make(chan bool)

	// æ³¨æ„è¿™é‡ŒæŠŠè¯»å–chanæ“ä½œæ”¾åœ¨äº†å†™å…¥chanä¹‹å‰äº†ï¼ˆä¸ºäº†å®‰å…¨å»ºè®®å¯¹chançš„goroutinesè¯»å–æ”¾åœ¨å‰é¢ï¼Œå†™å…¥æ”¾åœ¨åé¢ï¼‰
	// å¦‚æœæŠŠè¿™è¡Œæ”¾åœ¨äº†foré€»è¾‘åé¢ï¼Œåˆ™ä¸Šé¢å£°æ˜çš„chanç¼“å†²åŒºå¤§å°ä¸€å®šè¦å¤§äº2000æ‰å¯ä»¥ï¼Œå¦åˆ™ç”±
	// äºç¼“å­˜åŒºä¸€æ¬¡æ”¾ä¸ä¸‹2000ä¸ªå…ƒç´ ï¼Œä»è€Œäº§ç”Ÿdeadlock
	go read(ch, quit)

	for i := 0; i < 2000; i++ {
		ch <- i
		fmt.Println(i)
	}

	quit <- true

	fmt.Println("\r\n====MAIN END====")
	endTime := time.Now().Second()

	fmt.Println(startTime)
	fmt.Println(endTime)
	fmt.Println("ç”¨æ—¶:", endTime-startTime, "ç§’")
}

func read(ch chan int, quit chan bool) {
	for {
		select {
		case value := <-ch:
			fmt.Print("----", value, "----")
		case <-quit:
			break
		}

	}
}

```

**channelæ€»ç»“ï¼š**
channelå…±åˆ†ä¸¤ç§ï¼šä¸€ç§æ˜¯æœ‰bufferçš„ï¼Œä¸€ç§æ˜¯æ²¡æœ‰bufferçš„ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰bufferçš„ï¼Œå³bufferé•¿åº¦ä¸º0

```
c := make(chan int) //æ— buffer
c := make(chan int, 0) //æ— buffer

c := make(chan int, 100) //æœ‰buffer

```

 * æœ‰ç¼“å†²çš„channelï¼Œä¸”å†™å…¥chanä¸ªæ•°>=ç¼“å­˜åŒºå¤§å°æ—¶ï¼Œå¯ä»¥å…ˆâ€œ **å†™**â€åâ€œè¯»â€ï¼Œå¦åˆ™åä¹‹
 * æ— ç¼“å†²çš„channelï¼Œè¦å…ˆâ€œ **è¯»**â€åâ€œå†™â€

æ³¨æ„æœ¬ä¾‹ä¸­è¿è¡Œåœ¨goroutinesä¸­çš„ä¸º**è¯»**æ“ä½œ
æ¨èï¼š [å¦‚ä½•ä¼˜é›…åœ°å…³é—­Go channel](https://www.jianshu.com/p/d24dfbb33781)
---
title: docker常用命令
author: admin
type: post
date: 2016-02-02T09:38:20+00:00
url: /archives/16555
categories:
 - 服务器
tags:
 - docker

---
官方命令： [https://docs.docker.com/reference/](https://docs.docker.com/reference/)

## 1. 查看docker信息（version、info）

```
# 查看docker版本
$docker version

# 显示docker系统的信息
$docker info
```

## 2. 对image的操作（search、pull、images、rmi、history）

```
# 检索image(sudo docker pull ubuntu:12.04,该命令实际上相当于 $ sudo docker pull registry.hub.docker.com/ubuntu:12.04 命令，即从注册服务器 registry.hub.docker.com 中的 ubuntu 仓库来下载标记为 12.04 的镜像。)
$docker search image_name[:tag]

# 下载image
$docker pull image_name

# 列出镜像列表; -a, --all=false Show all images; --no-trunc=false Don't truncate output; -q, --quiet=false Only show numeric IDs
$docker images

# 镜像重命名
docker tag ImageID(镜像id) REPOSITORY:TAG（仓库：标签）

# 删除一个或者多个镜像; -f, --force=false Force; --no-prune=false Do not delete untagged parents （注意这里是 rmi 命令，不是 rm）
$docker rmi image_name

# 显示一个镜像的历史; --no-trunc=false Don't truncate output; -q, --quiet=false Only show numeric IDs
$docker history image_name
```

## 3. 启动容器（run）

docker容器可以理解为在沙盒中运行的进程。这个沙盒包含了该进程运行所必须的资源，包括文件系统、系统类库、shell 环境等等。但这个沙盒默认是不会运行任何程序的。你需要在沙盒中运行一个进程来启动某一个容器。这个进程是该容器的唯一进程，所以当该进程结束的时候，容器也会完全的停止。


```
# 在容器中运行"echo"命令，输出"hello word"
$docker run image_name echo "hello word"

# 交互式进入容器中
$docker run -i -t image_name /bin/bash

# 在容器中安装新的程序
$docker run image_name apt-get install -y app_name
```

其中，**`-t`** 选项让Docker分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上， **`-i`** 则让容器的标准输入保持打开。

Note：  在执行apt-get 命令的时候，要带上-y参数。如果不指定-y参数的话，apt-get命令会进入交互模式，需要用户输入命令来进行确认，但在docker环境中是无法响应这种交互的。apt-get 命令执行完毕之后，容器就会停止，但对容器的改动不会丢失。

## 4. 查看容器（ps）

```
# 列出当前所有正在运行的container
$docker ps
# 列出所有的container
$docker ps -a
# 列出最近一次启动的container
$docker ps -l
```

## 5. 保存对容器的修改（commit）

当你对某一个容器做了修改之后（通过在容器中运行某一个命令），可以把对容器的修改保存下来，这样下次可以从保存后的最新状态运行该容器。

```
# 保存对容器的修改; -a, --author="" Author; -m, --message="" Commit message
$docker commit ID new_image_name
```

Note：  image相当于类，container相当于实例，不过可以动态给实例安装新软件，然后把这个container用commit命令固化成一个image。

## 6. 对容器的操作（rm、stop、start、kill、logs、diff、top、cp、restart、attach）

```
# 删除所有容器
$docker rm `docker ps -a -q`

# 删除单个容器; -f, --force=false; -l, --link=false Remove the specified link and not the underlying container; -v, --volumes=false Remove the volumes associated to the container
$docker rm Name/ID

# 停止、启动、杀死一个容器
$docker stop Name/ID
$docker start Name/ID
$docker kill Name/ID

# 从一个容器中取日志; -f, --follow=false Follow log output; -t, --timestamps=false Show timestamps
$docker logs Name/ID

# 列出一个容器里面被改变的文件或者目录，list列表会显示出三种事件，A 增加的，D 删除的，C 被改变的
$docker diff Name/ID

# 显示一个运行的容器里面的进程信息
$docker top Name/ID

# 从容器里面拷贝文件/目录到本地一个路径
$docker cp Name:/container_path to_path
$docker cp ID:/container_path to_path

# 重启一个正在运行的容器; -t, --time=10 Number of seconds to try to stop for before killing the container, Default=10
$docker restart Name/ID

# 附加到一个运行的容器上面; --no-stdin=false Do not attach stdin; --sig-proxy=true Proxify all received signal to the process
$docker attach ID
Note： attach命令允许你查看或者影响一个运行的容器。你可以在同一时间attach同一个容器。你也可以从一个容器中脱离出来，或者按CTRL-C。注意这种方式进入窗口再退出窗口会自动停止。
或者
sudo docker exec -it CONTAINER-NAME|CONTAINER-ID /bin/bash // 推荐,参考：https://www.cnblogs.com/xhyan/p/6593075.html

# 查看窗口环境变量
$docker inspect CONTAINER-NAME|CONTAINER-ID
或者
$docker exec -it CONTAINER-NAME|CONTAINER-ID env // 推荐

# 在容器运行一个命令
$docker exec -it CONTAINER-NAME|CONTAINER-ID echo "test"
会打印输出 test 字样

```

命令示例： [https://docs.gitlab.com/omnibus/docker/](https://docs.gitlab.com/omnibus/docker/)

## 7. 保存和加载镜像（save、load）

当需要把一台机器上的镜像迁移到另一台机器的时候，需要保存镜像与加载镜像。

```
# 保存镜像到一个tar包; -o, --output="" Write to an file
$docker save image_name -o file_path
# 加载一个tar包格式的镜像; -i, --input="" Read from a tar archive file
$docker load -i file_path

# 机器a
$docker save image_name > /home/save.tar
# 使用scp将save.tar拷到机器b上，然后：
$docker load < /home/save.tar
```

## 8、 登录registry server（login）

```
# 登陆registry server; -e, --email="" Email; -p, --password="" Password; -u, --username="" Username
$docker login
```

如果提示错误

```
Error saving credentials: error storing credentials - err: exit status 1, out: `The user name or passphrase you entered is not correct.`
```

”解决办法为

```
rm /usr/local/bin/docker-credential-osxkeychain
```

## 9. 发布image（push）

```
# 发布docker镜像
$docker push new_image_name
```

## 10.  根据Dockerfile 构建出一个容器

```
#build
      --no-cache=false Do not use cache when building the image
      -q, --quiet=false Suppress the verbose output generated by the containers
      --rm=true Remove intermediate containers after a successful build
      -t, --tag="" Repository name (and optionally a tag) to be applied to the resulting image in case of success
$docker build -t image_name Dockerfile_path
```

## 11. Docker 修改已有镜像（commit ）

```
docker commit -m '说明信息' -a '作者信息' 容器ID 镜像ID名称[:TAG_ID]
```

修改成功后，返回镜像ID信息，如 sha256:e53af4b57f5db62e8129031353a41147ab25c5c33e89b460dec97472eefdacd1

以上是通过修改容器来实现对镜像的创建，如果只是仅仅想保留容器的内容，省略掉命令后面的镜像信息即可。
[https://blog.csdn.net/jiankunking/article/details/62056392](https://blog.csdn.net/jiankunking/article/details/62056392)

推荐阅读： [如何使用Dockerfile构建镜像](http://blog.csdn.net/we_shell/article/details/38445979)



参考： [http://blog.csdn.net/zhang__jiayu/article/details/42611469](http://blog.csdn.net/zhang__jiayu/article/details/42611469)